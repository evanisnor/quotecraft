# Decision Log — 2026-03-01

## Task: BLDR-US2-A003 — Implement Dropdown field type with option list editor

**Requirement:** 1.3.1 — Builder supports Dropdown / Select fields with configurable options (label + value pairs)

---

## Decisions Made

### 1. `FieldOption` and `DropdownFieldConfig` placed in `shared/config/calculatorConfig.ts`

These types belong in `shared/config` because they are domain types shared across feature boundaries. `OptionListEditor` will be reused by A004 (Radio) and A005 (Checkbox), and those features also need `FieldOption`. Placing the types in `shared/config` prevents lateral imports between feature slices.

### 2. `generateId()` placed in `shared/lib/generateId.ts`

The ID generator is a stateless utility with no domain knowledge — it belongs in `shared/lib`. It is intentionally not exposed to tests so tests do not assert on ID format, only on the presence and type of the generated ID string.

### 3. `OptionListEditor` is deliberately unaware of field type

The component accepts `FieldOption[]` and `onChange: (options: FieldOption[]) => void` with no coupling to dropdown, radio, or checkbox. This allows A004 and A005 to reuse it directly without modification.

### 4. Index-based input IDs (`option-label-0`, `option-value-0`)

The task spec calls for index-based IDs since positions are stable within a single interaction. The `key` prop uses `option.id` (stable across re-renders) while the `htmlFor`/`id` pairing uses the array index so labels always associate with the correct input even after options are removed.

### 5. Disambiguation in `DropdownFieldConfigPanel` tests

When `DropdownFieldConfigPanel` renders both `FieldConfigPanel` (which has a "Label" label for `#field-label`) and `OptionListEditor` (which has "Label" labels for `#option-label-0`, `#option-label-1`, etc.), `getByLabelText('Label')` is ambiguous. Tests that target the base field label input use `getByLabelText('Label', { selector: '#field-label' })` to resolve the ambiguity without changing any production code.

### 6. `DropdownFieldConfigPanel.handleBaseUpdate` explicitly reattaches `type: 'dropdown'`

`FieldConfigPanel` receives and returns `BaseFieldConfig`, which only knows `type: FieldType`. When the base panel calls `onUpdate`, the returned object loses the `'dropdown'` discriminant. `handleBaseUpdate` spreads the base result and explicitly sets `type: 'dropdown'` alongside the existing `options` array to restore the `DropdownFieldConfig` shape.

---

## Technical Challenges

### Label ambiguity in `DropdownFieldConfigPanel` tests

When rendering both panels together, there are multiple elements labeled "Label" (one from the base panel's field label input, two from option label inputs). The fix was to qualify the base panel's label lookup with `{ selector: '#field-label' }` — the ID is fixed and stable in `FieldConfigPanel`.

No production code was changed to work around this; it was purely a test query precision issue.

---

## Bugfix: Next.js root path returning 404 (unrelated to any task)

### Problem

Running `make dev` in the `dashboard` package produced a 404 for `GET /` immediately on startup. All App Router routes were unreachable.

### Root cause

`next.config.ts` had a custom `pageExtensions: ['page.tsx', 'page.ts', 'page.jsx', 'page.js']` setting. The intent was to prevent Next.js from treating FSD barrel files in `src/pages/` (e.g. `src/pages/dashboard/index.ts`) as Pages Router routes.

The setting had the opposite effect on App Router files. Next.js constructs the expected filename for each App Router special file as `{special-name}.{extension}`. With the custom extensions, it looked for `page.page.tsx`, `layout.page.tsx`, etc. — none of which exist. Every route returned 404 as a result.

### Resolution

Two changes:

1. **Removed `pageExtensions` from `next.config.ts`**, restoring the default `['tsx', 'ts', 'jsx', 'js']`. This allows `page.tsx` and `layout.tsx` to be recognized as App Router special files again.

2. **Renamed `src/pages/` to `src/views/`**. With default extensions, Next.js would scan `src/pages/` and pick up FSD barrel files (e.g. `src/pages/dashboard/index.ts`) as Pages Router routes. Renaming the directory removes it from Next.js's scan path entirely without any framework configuration.

Import paths in the three App Router route files that referenced `@/pages/*` were updated to `@/views/*`.
